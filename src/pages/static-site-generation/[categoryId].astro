---
import Layout from "../../layouts/Layout.astro";
import Product from "../../components/Product.astro";
import { getProducts } from "../../lib/api";
import { categoryList } from "../../constants";
import PLPSideBar from "../../components/PLPSideBar.astro";
import { RecommendedProducts } from "../../components/RecommendedProducts";

export async function getStaticPaths() {
  const staticPaths = categoryList.map((category) => ({
    params: { categoryId: category },
  }));

  return staticPaths;
}

const products = await getProducts(Astro.params.categoryId);
export const prerender = true;
---

<Layout title="Welcome to Astro.">
  <main>
    <div class="overflow-y-scroll bg-gray-1100 bg-[url('/grid.svg')] pb-36">
      <div class="space-y-8 lg:space-y-14">
        <PLPSideBar prefix="static-site-generation" />

        <div class="lg:pl-72">
          <div class="mx-auto max-w-8xl space-y-8 px-2 pt-20 lg:px-8 lg:py-8">
            <div class="grid grid-cols-3 xl:grid-cols-4 gap-4">
              {products.map((product) => <Product product={product} />)}
            </div>

            <RecommendedProducts client:visible={{rootMargin: "500px"}} />
          </div>
        </div>
      </div>
    </div>
  </main>
</Layout>
